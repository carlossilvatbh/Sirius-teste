<!DOCTYPE html>
<html>
<head>
    <title>Debug Canvas</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .success { background: #e8f5e8; color: #2e7d32; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .info { background: #e3f2fd; color: #1565c0; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Canvas Debug</h1>
    
    <div id="debug-log">
        <h3>Debug Log:</h3>
        <div id="log-content"></div>
    </div>
    
    <div id="simple-vue-test">
        <h3>Simple Vue Test:</h3>
        <div>{{ message }}</div>
        <button @click="changeMessage">Change Message</button>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = new Date().toLocaleTimeString() + ': ' + message;
            logDiv.appendChild(entry);
            console.log(message);
        }
        
        // Test 1: Vue.js basic functionality
        log('Testing Vue.js basic functionality...');
        
        try {
            const { createApp } = Vue;
            
            createApp({
                data() {
                    return {
                        message: 'Vue.js is working!'
                    }
                },
                methods: {
                    changeMessage() {
                        this.message = 'Message changed at ' + new Date().toLocaleTimeString();
                    }
                }
            }).mount('#simple-vue-test');
            
            log('Vue.js basic test mounted successfully', 'success');
        } catch (error) {
            log('Vue.js basic test failed: ' + error.message, 'error');
        }
        
        // Test 2: Simulate window.djangoData
        log('Setting up mock Django data...');
        
        window.djangoData = {
            csrfToken: 'mock-csrf-token',
            apiUrls: {
                estruturas: '/api/estruturas/',
                templates: '/api/templates/',
                calcularCustos: '/api/calcular-custos/',
                validarConfiguracao: '/api/validar-configuracao/',
                salvarConfiguracao: '/api/salvar-configuracao/',
                aplicarTemplate: '/api/aplicar-template/',
                generatePdf: '/api/gerar-pdf/'
            }
        };
        
        log('Mock Django data set up', 'success');
        
        // Test 3: Check if the main JS file loads without errors
        log('Checking if main JS file can be loaded...');
        
        fetch('/static/js/sirius-app.js')
            .then(response => {
                if (response.ok) {
                    log('Main JS file is accessible', 'success');
                    return response.text();
                } else {
                    log('Main JS file not accessible: ' + response.status, 'error');
                }
            })
            .then(jsContent => {
                if (jsContent) {
                    log('JS file loaded, length: ' + jsContent.length + ' characters', 'success');
                    
                    // Check for syntax errors
                    try {
                        new Function(jsContent);
                        log('JS file syntax is valid', 'success');
                    } catch (syntaxError) {
                        log('JS file has syntax errors: ' + syntaxError.message, 'error');
                    }
                }
            })
            .catch(error => {
                log('Failed to load main JS file: ' + error.message, 'error');
            });
    </script>
</body>
</html>
